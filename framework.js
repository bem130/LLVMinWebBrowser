var DEBUG=0;var DEBUG_MEMORY=0;var MemoryDebugger={clear:function(){MemoryDebugger.time=Date.now();MemoryDebugger.datas={};var a=MemoryDebugger.doGC();MemoryDebugger.last=a[2];MemoryDebugger.max=0;MemoryDebugger.tick("--clear--")},doGC:function(){var a=gc().replace("\n","");print("zz raw gc info: "+a);return/before (\d+), after (\d+),.*/.exec(a)},tick:function(b){var c=Date.now();if(c-this.time>1000){this.time=c}var h=gc().replace("\n","");var d=MemoryDebugger.doGC();var g=d[1];var a=d[2];MemoryDebugger.max=Math.max(MemoryDebugger.max,g,a);var i=g-a;var f=a-MemoryDebugger.last;print("zz gc stats changes: "+[b,f,i]);MemoryDebugger.last=a;if(Math.abs(i)+Math.abs(f)>0){var e=MemoryDebugger.datas[b];if(!e){e=MemoryDebugger.datas[b]={name:b,count:0,garbage:0,real:0}}e.garbage+=i;e.real+=f;e.count++}MemoryDebugger.dump()},dump:function(){var a=values(MemoryDebugger.datas);print("zz max: "+(MemoryDebugger.max/(1024*1024)).toFixed(3));print("zz real:");a.sort(function(b,c){return c.real-b.real});a.forEach(function(b){if(Math.abs(b.real)>1024*1024){print("zz    "+b.name+" real = "+(b.real/(1024*1024)).toFixed(3)+" mb")}});print("zz garbage:");a.sort(function(b,c){return c.garbage-b.garbage});a.forEach(function(b){if(Math.abs(b.garbage)>1024*1024){print("zz    "+b.name+" garbage = "+(b.garbage/(1024*1024)).toFixed(3)+" mb")}})}};if(DEBUG_MEMORY){MemoryDebugger.clear()}function Substrate(a){this.name_=a;this.actors={};this.currUid=1}Substrate.prototype={addItem:function(b,a){if(a=="/dev/null"){return}if(a=="/dev/stdout"){this.results.push(b);return}this.actors[a].inbox.push(b)},addItems:function(a,b){if(b=="/dev/null"){return}if(b=="/dev/stdout"){this.results=this.results.concat(a);return}this.actors[b].inbox=this.actors[b].inbox.concat(a)},checkInbox:function(c){var a=c.inbox;for(var b=0;b<a.length;b++){var d=a[b];if(!d.__uid__){d.__uid__=this.currUid;this.currUid++}}var e=Infinity;if(e==Infinity){c.inbox=[];c.items=c.items.concat(a)}else{throw"Warning: Enter this code at your own risk. It can save memory, but often regresses speed.";c.inbox=a.slice(e);c.items=c.items.concat(a.slice(0,e))}},addActor:function(b,a){assert(b&&a);a.name_=b;a.items=[];a.inbox=[];a.forwardItem=bind(this,this.addItem);a.forwardItems=bind(this,this.addItems);this.actors[b]=a;if(!a.process){a.process=Actor.prototype.process}return a},solve:function(){dprint("framework","// Solving "+this.name_+"...");if(DEBUG_MEMORY){MemoryDebugger.tick("pre-run substrate "+this.name_+" (priors may be cleaned)")}var a=Date.now();var b=a;var k=this;function j(){var i=Date.now();if(i-b>500){dprint("framework","// Working on "+k.name_+", so far "+((i-a)/1000).toString().substr(0,10)+" seconds.");b=i}}function m(){dprint("framework","// Completed "+k.name_+" in "+((Date.now()-a)/1000).toString().substr(0,10)+" seconds.")}var l=null;var c=null;this.results=[];var e=false;var o=this.onResult;var g=values(this.actors);while(!e){dprint("framework","Cycle start, items: ");var n=false;for(var h=0;h<g.length;h++){var f=g[h];if(f.inbox.length==0&&f.items.length==0){continue}j();this.checkInbox(f);var p;var d=this.results.length;dprint("framework","Processing using "+f.name_+": "+f.items.length);p=f.process(f.items);f.items=[];if(DEBUG_MEMORY){MemoryDebugger.tick("actor "+f.name_)}dprint("framework","New results: "+(p.length+this.results.length-d)+" out of "+(this.results.length+p.length));n=true;if(p&&p.length>0){if(p.length===1&&p[0].__finalResult__){if(DEBUG){print("Solving complete: __finalResult__")}delete p[0].__finalResult__;delete p[0].__uid__;m();e=true;c=p[0]}else{this.results=this.results.concat(p)}}}if(!n){if(DEBUG){print("Solving complete: no remaining items")}m();this.results.forEach(function(i){delete i.__uid__;if(o){o(i)}});l=this.results;this.results=null;break}if(c){l=c;break}j()}g.forEach(function(i){i.items=null;i.inbox=null});if(DEBUG_MEMORY){MemoryDebugger.tick("finished "+this.name_)}return l}};var Framework={currItem:null};function Actor(){}Actor.prototype={process:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];a[c]=null;dprint("frameworkLines","Processing item for llvm line "+d.lineNum);Framework.currItem=d;var e=this.processItem(d);Framework.currItem=null;if(e){b=b.concat(e)}}return b}};